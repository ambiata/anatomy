<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <com.coravy.hudson.plugins.github.GithubProjectProperty plugin="github@1.8">
      <projectUrl>https://github.com/ambiata/${project}/</projectUrl>
    </com.coravy.hudson.plugins.github.GithubProjectProperty>
    <jenkins.plugins.hipchat.HipChatNotifier_-HipChatJobProperty plugin="hipchat@0.1.4">
      <room>${env_HIPCHAT_ROOM}</room>
      <startNotification>true</startNotification>
    </jenkins.plugins.hipchat.HipChatNotifier_-HipChatJobProperty>
  </properties>
  <scm class="hudson.plugins.git.GitSCM" plugin="git@2.2.1">
    <configVersion>2</configVersion>
    <userRemoteConfigs>
      <hudson.plugins.git.UserRemoteConfig>
        <refspec>+refs/pull/*:refs/remotes/origin/pr/*</refspec>
        <url>git@github.com:ambiata/${project}.git</url>
        <credentialsId>5f4132aa-ee98-4957-8669-16e758ccaf26</credentialsId>
      </hudson.plugins.git.UserRemoteConfig>
    </userRemoteConfigs>
    <branches>
      <hudson.plugins.git.BranchSpec>
        <name>*/pr/*/head</name>
      </hudson.plugins.git.BranchSpec>
    </branches>
    <doGenerateSubmoduleConfigurations>false</doGenerateSubmoduleConfigurations>
    <browser class="hudson.plugins.git.browser.GithubWeb">
      <url>https://github.com/ambiata/${project}</url>
    </browser>
    <submoduleCfg class="list"/>
    <extensions/>
  </scm>
  <canRoam>true</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers>
    <com.cloudbees.jenkins.GitHubPushTrigger plugin="github@1.8">
      <spec></spec>
    </com.cloudbees.jenkins.GitHubPushTrigger>
  </triggers>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.tasks.Shell>
      <command>set +x
  curl --silent -XPOST -H &quot;Authorization: token $$JENKINS_TOKEN&quot; https://api.github.com/repos/ambiata/${project}/statuses/$$(git rev-parse HEAD) -d &quot;{
  \&quot;state\&quot;: \&quot;pending\&quot;,
  \&quot;target_url\&quot;: \&quot;$${BUILD_URL}\&quot;,
  \&quot;description\&quot;: \&quot;The build is in progress...\&quot;,
  \&quot;context\&quot;: \&quot;$${JOB_NAME}\&quot;
}&quot; &gt; /dev/null || echo "Ignore pending error"</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>
export HIPCHAT_TOKEN
${env_CI_COMMAND}
      </command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>set +x
curl --silent -XPOST -H &quot;Authorization: token $$JENKINS_TOKEN&quot; https://api.github.com/repos/ambiata/${project}/statuses/$$(git rev-parse HEAD) -d &quot;{
  \&quot;state\&quot;: \&quot;success\&quot;,
  \&quot;target_url\&quot;: \&quot;$${BUILD_URL}\&quot;,
  \&quot;description\&quot;: \&quot;The build has succeeded!\&quot;,
  \&quot;context\&quot;: \&quot;$${JOB_NAME}\&quot;
}&quot; &gt; /dev/null

/usr/local/bin/log_upload $${JOB_NAME} $${BUILD_NUMBER}
  </command>
    </hudson.tasks.Shell>
  </builders>
  <publishers>
    <jenkins.plugins.hipchat.HipChatNotifier plugin="hipchat@0.1.4">
      <jenkinsUrl>${env_JENKINS_HOST}</jenkinsUrl>
      <authToken>${env_HIPCHAT_TOKEN}</authToken>
      <room>${env_HIPCHAT_ROOM}</room>
    </jenkins.plugins.hipchat.HipChatNotifier>
    <org.jenkinsci.plugins.postbuildscript.PostBuildScript plugin="postbuildscript">
      <buildSteps>
        <hudson.tasks.Shell>
          <command>set +x
curl --silent -XPOST -H &quot;Authorization: token $$JENKINS_TOKEN&quot; https://api.github.com/repos/ambiata/${project}/statuses/$$(git rev-parse HEAD) -d &quot;{
  \&quot;state\&quot;: \&quot;failure\&quot;,
  \&quot;target_url\&quot;: \&quot;$${BUILD_URL}\&quot;,
  \&quot;description\&quot;: \&quot;The build has failed!\&quot;,
  \&quot;context\&quot;: \&quot;$${JOB_NAME}\&quot;
}&quot; &gt; /dev/null

/usr/local/bin/log_upload $${JOB_NAME} $${BUILD_NUMBER}
  </command>
        </hudson.tasks.Shell>
      </buildSteps>
      <scriptOnlyIfSuccess>false</scriptOnlyIfSuccess>
      <scriptOnlyIfFailure>true</scriptOnlyIfFailure>
      <markBuildUnstable>false</markBuildUnstable>
    </org.jenkinsci.plugins.postbuildscript.PostBuildScript>
  </publishers>
  <buildWrappers/>
</project>
